basePath: /default/default
consumes:
- application/json
definitions:
  AcceptConsentRequest:
    properties:
      account_ids:
        description: List of accounts that user agreed to share on the consent page.
        items:
          type: string
        type: array
        x-nullable: false
      granted_scopes:
        $ref: '#/definitions/GrantedScopes'
      login_state:
        description: |-
          Random string generated by Cloudentity used to mitigate Cross-site request forgery (CSRF) attacks.
          Cloudentity sends state as login_state query param when redirecting to the consent page.
        example: '"cauq8fonbud6q8806bf0"'
        format: loginState
        type: string
        x-nullable: false
    type: object
  AuthenticationContext:
    additionalProperties:
      type: object
    type: object
  ClientInfo:
    properties:
      client_name:
        description: Human-readable name of a client application.
        example: My app
        type: string
        x-nullable: false
      client_uri:
        description: URI of a client application.
        type: string
        x-nullable: false
      description:
        description: Description of the client application.
        type: string
        x-nullable: false
      logo_uri:
        description: Logo URI.
        type: string
        x-nullable: false
      organisation_id:
        description: |-
          External organization identifier. It is a unique string assigned by the CDR Register to identify an Accredited
          Data Recipient Brand.

          The value obtained is used as the `aud` claim for message signing, for example, when a JSON Web Token (JWT) is
          required for authorization, and represents the audience(s) the JWT is intended for.
        example: 5647fe90-f6bc-11eb-9a03-0242ac130003
        type: string
        x-nullable: false
      policy_uri:
        description: Policy URL to read about how the profile data is used.
        type: string
        x-nullable: false
      tos_uri:
        description: Terms of Service URL.
        type: string
        x-nullable: false
    type: object
  ConsentAccepted:
    properties:
      redirect_to:
        description: |-
          A URL to redirect the user.
          It applies for the redirect flow only, i.e the consent page.
        example: https://authorization.cloudentity.com:8443/tenant/server/oauth2/authorize?client_id=bugkgm23g9kregtu051g&consent_verified=true&login_id=cavai7d8s9nelp7k792g&login_state=cauq8fonbud6q8806bf0
        type: string
        x-nullable: false
    type: object
  ConsentRejected:
    properties:
      redirect_to:
        description: |-
          A URL to redirect the user.
          It applies for the redirect flow only, i.e the consent page.
        example: https://authorization.cloudentity.com:8443/tenant/server/oauth2/authorize?client_id=bugkgm23g9kregtu051g&consent_verified=true&login_id=cavai7d8s9nelp7k792g&login_state=cauq8fonbud6q8806bf0
        type: string
        x-nullable: false
    type: object
  ConsentStatus:
    type: string
  ConsentType:
    type: string
  ConsentsRemovedResponse:
    properties:
      number_of_consents_removed:
        format: int64
        type: integer
        x-nullable: false
    type: object
  Error:
    description: HTTP error response
    properties:
      details:
        type: object
        x-nullable: false
      error:
        type: string
        x-nullable: false
      error_code:
        type: string
        x-nullable: false
      status_code:
        format: int64
        type: integer
        x-nullable: false
    type: object
  GetKSAConsentResponse:
    properties:
      account_ids:
        description: List of account identifiers
        items:
          type: string
        type: array
        x-nullable: false
      authentication_context:
        $ref: '#/definitions/AuthenticationContext'
      client_id:
        description: Client application identifier.
        example: '"cauqo9c9vpbs0aj2b2v0"'
        format: clientID
        type: string
        x-nullable: false
      client_info:
        $ref: '#/definitions/ClientInfo'
      consent_id:
        format: consentID
        type: string
        x-nullable: false
      created_at:
        description: Consent creation time
        format: date-time
        type: string
        x-nullable: false
      ksa_consent:
        $ref: '#/definitions/KSAConsent'
      requested_scopes:
        description: List of requested scopes
        items:
          $ref: '#/definitions/RequestedScope'
        type: array
        x-nullable: false
      server_id:
        description: Server / Workspace identifier.
        example: '"server"'
        format: serverID
        type: string
        x-nullable: false
      status:
        description: Consent status
        type: string
        x-nullable: false
      subject:
        description: Subject
        format: subject
        type: string
        x-nullable: false
      tenant_id:
        description: Tenant identifier.
        example: '"tenant"'
        format: tenantID
        type: string
        x-nullable: false
      type:
        $ref: '#/definitions/ConsentType'
    type: object
  GrantedScopes:
    items:
      format: scopeName
      type: string
    type: array
  KSAConsent:
    properties:
      client_id:
        description: Client application identifier
        example: bugkgm23g9kregtu051g
        format: clientID
        type: string
        x-nullable: false
      consent_id:
        description: Consent identifier
        example: cavbbioiagh6fla7koig
        type: string
        x-nullable: false
      created_at:
        description: Consent creation date
        example: "2022-07-01T08:52:27.127932Z"
        format: date-time
        type: string
        x-nullable: false
      expiry:
        description: Consent expiration date
        example: "2023-03-01T09:02:27.127932Z"
        format: date-time
        type: string
        x-nullable: false
      server_id:
        description: Workspace identifier
        example: server
        format: serverID
        type: string
        x-nullable: false
      status:
        $ref: '#/definitions/ConsentStatus'
      tenant_id:
        description: Tenant identifier
        example: my-company
        format: tenantID
        type: string
        x-nullable: false
    type: object
  Metadata:
    additionalProperties:
      type: object
    type: object
  RejectConsentRequest:
    properties:
      error:
        description: Rejection error indication.
        example: Rejected
        type: string
        x-nullable: false
      error_cause:
        description: Rejection cause.
        example: Rejected by the user.
        type: string
        x-nullable: false
      error_description:
        description: Rejection error description.
        example: The user rejected authentication.
        type: string
        x-nullable: false
      id:
        description: Login identifier.
        format: loginID
        type: string
        x-nullable: false
      login_state:
        description: |-
          Random string generated by Cloudentity used to mitigate cross-site request forgery (CSRF) attacks.
          Cloudentity sends state as the `login_state` query parameter when redirecting to the consent page.
        example: cauq8fonbud6q8806bf0
        format: loginState
        type: string
        x-nullable: false
      status_code:
        description: Rejection HTTP status code.
        example: 403
        format: int64
        type: integer
        x-nullable: false
    type: object
  RequestedScope:
    properties:
      authorization_server_id:
        description: Authorization server identifier
        example: my-server
        format: serverID
        type: string
        x-nullable: false
      description:
        description: The scope description displayed as a hint on a consent page
        example: This scope value requests offline access using refresh token
        type: string
        x-nullable: false
      display_name:
        description: The scope name displayed on a consent page
        example: Offline Access
        type: string
        x-nullable: false
      id:
        description: Scope identifier
        example: scope-1
        format: scopeID
        type: string
        x-nullable: false
      implicit:
        description: Request this scope by default for all clients who subscribed
          to this scope
        type: boolean
        x-nullable: false
      implicit_grant:
        description: Do not ask for consent for this scope
        type: boolean
        x-nullable: false
      metadata:
        $ref: '#/definitions/Metadata'
      name:
        description: Scope name
        example: offline_access
        format: scopeName
        type: string
        x-nullable: false
      params:
        items:
          type: string
        type: array
        x-nullable: false
      requested_name:
        format: scopeName
        type: string
        x-nullable: false
      service:
        $ref: '#/definitions/Service'
      tenant_id:
        description: Tenant identifier
        example: my-company
        format: tenantID
        type: string
        x-nullable: false
      transient:
        description: Disable storage of scope grants
        type: boolean
        x-nullable: false
      with_service:
        type: boolean
        x-nullable: false
    type: object
  Service:
    properties:
      authorization_server_id:
        description: Authorization server identifier
        example: my-server
        format: serverID
        type: string
        x-nullable: false
      custom_audience:
        description: Custom service audience
        example: https://api.example.com
        type: string
        x-nullable: false
      description:
        description: Service description
        example: Service description
        type: string
        x-nullable: false
      gateway_id:
        description: Gateway identifier
        example: gateway-1
        format: gatewayID
        type: string
        x-nullable: false
      id:
        description: A unique identifier of a service
        example: service-1
        format: serviceID
        type: string
        x-nullable: false
      name:
        description: Service name
        example: My service
        type: string
        x-nullable: false
      system:
        description: '`true` when the service is a system service'
        example: false
        type: boolean
        x-nullable: false
      tenant_id:
        description: Tenant identifier
        example: my-company
        format: tenantID
        type: string
        x-nullable: false
      type:
        default: user
        description: Service type
        enum:
        - oauth2
        - oidc
        - system
        - user
        - openbanking
        type: string
        x-nullable: false
      updated_at:
        description: The date of service update
        format: date-time
        type: string
        x-nullable: false
      with_specification:
        description: '`true` when the service has the OpenAPI 3.0 specification'
        type: boolean
        x-nullable: false
    type: object
host: localhost:8443
info:
  description: |-
    Cloudentity's [Kingdom of Saudi Arabia Open Banking](https://openbanking.sa/index-en.html) API collection
    meets the guidelines of the Open Banking Framework for products and services operating in line with the
    Fintech Strategy.

    The collection covers two endpoints to handle KSA consents and an endpoint to retrieve consent data for building
    a [custom consent page](https://cloudentity.com/developers/basics/openfinance/consent-management/).

    API requests must feature the explicitly defined `manage_openbanking_consents` scope the client application can access.
    [Enable](https://cloudentity.com/developers/howtos/access-control/creating-and-configuring-dynamic-scopes/#add-scope)
    this scope for your client application in advance.

    Learn more about the
    [Open Finance ecosystems](https://cloudentity.com/developers/basics/openfinance/api-security-profiles-for-open-finance/).
    When your need to get familiar with terms and abbreviations, read our
    [Open Banking Glossary](https://cloudentity.com/developers/basics/openfinance/glossary-ob/).
  title: Cloudentity KSA Open Banking APIs
  version: latest
paths:
  /ksa/consent/{login}:
    get:
      description: |-
        This API can be used by a custom openbanking consent page.
        The consent page must first use client credentials flow to create consent.
      operationId: getKSAConsentSystem
      parameters:
      - in: path
        name: login
        required: true
        type: string
      - in: query
        name: login_state
        type: string
      responses:
        "200":
          $ref: '#/responses/GetKSAConsentResponse'
        "401":
          $ref: '#/responses/unauthorizedHTTPError'
        "403":
          $ref: '#/responses/forbiddenHTTPError'
        "404":
          $ref: '#/responses/notFoundHTTPError'
        "429":
          $ref: '#/responses/tooManyRequestsHTTPError'
      security:
      - system:
        - manage_openbanking_consents
      summary: Get KSA consent
      tags:
      - CONSENT_PAGE
  /ksa/consent/{login}/accept:
    post:
      description: This API can be used by a custom openbanking consent page to notify
        ACP that user granted consent to a customer data access.
      operationId: acceptKSAConsentSystem
      parameters:
      - in: path
        name: login
        required: true
        type: string
      - in: body
        name: AcceptConsent
        schema:
          $ref: '#/definitions/AcceptConsentRequest'
      responses:
        "200":
          $ref: '#/responses/ConsentAccepted'
        "401":
          $ref: '#/responses/unauthorizedHTTPError'
        "403":
          $ref: '#/responses/forbiddenHTTPError'
        "404":
          $ref: '#/responses/notFoundHTTPError'
        "429":
          $ref: '#/responses/tooManyRequestsHTTPError'
      security:
      - system:
        - manage_openbanking_consents
      summary: Accept KSA consent
      tags:
      - CONSENT_PAGE
  /ksa/consent/{login}/reject:
    post:
      description: This API can be used by a custom openbanking consent page to notify
        ACP that user rejected access.
      operationId: rejectKSAConsentSystem
      parameters:
      - in: path
        name: login
        required: true
        type: string
      - in: body
        name: RejectConsent
        schema:
          $ref: '#/definitions/RejectConsentRequest'
      responses:
        "200":
          $ref: '#/responses/ConsentRejected'
        "401":
          $ref: '#/responses/unauthorizedHTTPError'
        "403":
          $ref: '#/responses/forbiddenHTTPError'
        "404":
          $ref: '#/responses/notFoundHTTPError'
        "429":
          $ref: '#/responses/tooManyRequestsHTTPError'
      security:
      - system:
        - manage_openbanking_consents
      summary: Reject KSA consent
      tags:
      - CONSENT_PAGE
produces:
- application/json
responses:
  ConsentAccepted:
    description: Consent Accepted
    schema:
      $ref: '#/definitions/ConsentAccepted'
  ConsentRejected:
    description: Consent rejected
    schema:
      $ref: '#/definitions/ConsentRejected'
  ConsentsRemovedResponse:
    description: Consents Revoked
    schema:
      $ref: '#/definitions/ConsentsRemovedResponse'
  GetKSAConsentResponse:
    description: GetKSAConsentResponse
    schema:
      $ref: '#/definitions/GetKSAConsentResponse'
  badRequestHTTPError:
    description: Bad request
    schema:
      $ref: '#/definitions/Error'
  conflictHTTPError:
    description: Conflict
    schema:
      $ref: '#/definitions/Error'
  forbiddenHTTPError:
    description: Forbidden
    schema:
      $ref: '#/definitions/Error'
  internalServerErrorHTTPError:
    description: Internal server error
    schema:
      $ref: '#/definitions/Error'
  methodNotAllowedHTTPError:
    description: Method not allowed
    schema:
      $ref: '#/definitions/Error'
  notFoundHTTPError:
    description: Not found
    schema:
      $ref: '#/definitions/Error'
  payloadTooLargeHTTPError:
    description: Payload too large
    schema:
      $ref: '#/definitions/Error'
  preconditionFailedHTTPError:
    description: Precondition failed
    schema:
      $ref: '#/definitions/Error'
  tooManyRequestsHTTPError:
    description: Too many requests
    schema:
      $ref: '#/definitions/Error'
  unauthorizedHTTPError:
    description: Unauthorized
    schema:
      $ref: '#/definitions/Error'
  unprocessableEntityHTTPError:
    description: Unprocessable entity
    schema:
      $ref: '#/definitions/Error'
schemes:
- https
securityDefinitions:
  default:
    authorizationUrl: /default/default/oauth2/authorize
    flow: accessCode
    scopes:
      dcr_register: dcr_register
      introspect_openbanking_tokens: introspect_openbanking_tokens
    tokenUrl: /default/default/oauth2/token
    type: oauth2
  defaultcc:
    authorizationUrl: /default/default/oauth2/authorize
    flow: application
    scopes:
      accounts: accounts
      consents: consents
      payments: payments
    tokenUrl: /default/default/oauth2/token
    type: oauth2
  system:
    authorizationUrl: /default/system/oauth2/authorize
    flow: application
    scopes:
      manage_openbanking_consents: manage_openbanking_consents
    tokenUrl: /default/system/oauth2/token
    type: oauth2
swagger: "2.0"
